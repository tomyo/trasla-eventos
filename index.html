<!DOCTYPE html>
<html lang="es-AR">
  <head>
    <meta name="theme-color" content="#e6deca" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/favicon-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/icons/favicon-512x512.png" />

    <!-- START CONTENT_METADATA_BLOCK -->
    <title>La Agenda Cultural de Traslasierra | Trasla Eventos</title>
    <link rel="alternate" type="application/ld+json" href="/events/schema.jsonld" />
    <link rel="canonical" property="og:url" href="https://eventos.trasla.com.ar" />
    <meta
      name="description"
      property="og:description"
      content="Consulta prÃ³ximos eventos, talleres y festivales en Traslasierra: Mina Clavero, Nono, Villa de Las Rosas, Merlo y mÃ¡s. DescubrÃ­ quÃ© hacer hoy y este fin de semana en Traslasierra."
    />
    <meta property="og:title" content="La Agenda Cultural de Traslasierra" />
    <meta property="og:image" content="https://eventos.trasla.com.ar/assets/images/og-image-1200w-900h.avif" />
    <meta property="og:image:type" content="image/avif" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="900" />
    <meta property="og:image" content="https://eventos.trasla.com.ar/assets/images/og-image-1200w-900h.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="900" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://eventos.trasla.com.ar" />

    <meta property="og:site_name" content="TRASLA EVENTOS" />
    <meta property="og:locale" content="es-AR" />

    <!-- END CONTENT_METADATA_BLOCK -->

    <script type="module" src="/components/event-entry.js"></script>
    <script type="module" src="/components/events-filter.js"></script>
    <script type="module" src="/components/site-header.js"></script>
    <script type="module" src="/components/fixed-background.js"></script>
    <script type="module" src="/components/hero-section.js"></script>
    <script type="module" src="/components/install-button.js"></script>
    <link rel="manifest" href="/manifest.json" />
    <link rel="stylesheet" href="/base.css" />

    <!-- Partytown START: offload thirdâ€‘party / intensive scripts to a Worker -->
    <!-- <script>
      partytown = {
        forward: ["dataLayer.push"], // forward dataLayer.push calls into the Worker (gtag support)
      };
    </script>
    <script src="/~partytown/partytown.js" async></script> -->
    <!-- Partytown END -->
  </head>
  <body>
    <script src="/components/today-date-picker.js" type="module"></script>
    <fixed-background></fixed-background>
    <site-header></site-header>
    <hero-section>
      <h1 slot="title">La agenda cultural de Traslasierra</h1>
    </hero-section>
    <main>
      <section id="eventos" class="mountains-top" aria-label="Eventos">
        <events-filter id="eventsFilter">
          <form>
            <h2 class="form-filters-as-heading">
              <span>Eventos en</span>
              <select-styled>
                <select name="locality" aria-label="Localidad">
                  <option value="" default>TRASLASIERRA</option>
                  <option value="Arroyo de Los Patos">ARROYO DE LOS PATOS</option>
                  <option value="Boca del Rio">BOCA DEL RIO</option>
                  <option value="Dique de La ViÃ±a">DIQUE DE LA VIÃ‘A</option>
                  <option value="El Pueblito">EL PUEBLITO</option>
                  <option value="La Paz">LA PAZ</option>
                  <option value="La PoblaciÃ³n">LA POBLACIÃ“N</option>
                  <option value="Las Calles">LAS CALLES</option>
                  <option value="Las Chacras">LAS CHACRAS</option>
                  <option value="Las Rabonas">LAS RABONAS</option>
                  <option value="Las Tapias">LAS TAPIAS</option>
                  <option value="Los Hornillos">LOS HORNILLOS</option>
                  <option value="Los Molles">LOS MOLLES</option>
                  <option value="Los Pozos">LOS POZOS</option>
                  <option value="Luyaba">LUYABA</option>
                  <option value="Mina Clavero">MINA CLAVERO</option>
                  <option value="Nono">NONO</option>
                  <option value="Panaholma">PANAHOLMA</option>
                  <option value="Piedra Pintada">PIEDRA PINTADA</option>
                  <option value="San Huberto">SAN HUBERTO</option>
                  <option value="San Javier">SAN JAVIER</option>
                  <option value="San Lorenzo">SAN LORENZO</option>
                  <option value="San Pedro">SAN PEDRO</option>
                  <option value="Travesia">TRAVESIA</option>
                  <option value="Villa Cura Brochero">VILLA CURA BROCHERO</option>
                  <option value="Villa de Merlo">VILLA DE MERLO</option>
                  <option value="Villa de Las Rosas">VILLA DE LAS ROSAS</option>
                  <option value="Villa Dolores">VILLA DOLORES</option>
                  <option value="Yacanto">YACANTO</option>
                  <option value="Virtual">VIRTUAL</option>
                </select>
              </select-styled>
              <span data-nosnippet>A Partir de<span id="hideOnToday">l</span></span>
              <today-date-picker onclick="dateFrom.showPicker()">
                <input id="dateFrom" type="date" name="startDate" aria-label="Fecha de inicio" />

                <style>
                  form:has(today-date-picker[today]) #hideOnToday {
                    display: none;
                  }

                  today-date-picker {
                    position: relative;

                    > * {
                      width: 100%;
                    }

                    &:not(:focus-within)[today] {
                      &::before {
                        content: "Hoy";
                        position: absolute;
                        inset: 0;
                        display: grid;
                        place-content: center;
                        background-color: var(--background-color-darker);
                        z-index: 1;
                      }

                      &::after {
                        content: "";
                        position: absolute;
                        top: 50%;
                        right: 0.5rem;
                        width: 0;
                        height: 0;
                        border-left: 0.25rem solid transparent;
                        border-right: 0.25rem solid transparent;
                        border-top: 0.25rem solid gray;
                        margin-top: -0.1rem;
                        z-index: 1;
                      }
                    }
                  }
                </style>
              </today-date-picker>
            </h2>
            <input name="endDate" type="date" hidden />
            <label hidden>
              <input checked type="checkbox" name="activities[]" value="Evento" />
              Eventos
            </label>
            <label hidden>
              <input checked type="checkbox" name="activities[]" value="Taller" />
              Talleres
            </label>
            <label hidden> ðŸ”Ž </label>
            <input hidden type="search" name="search" placeholder=" Palabras claves" style="width: 100%" />
          </form>
          <event-entries>
            <!-- SSR (via [{slug|locality}].js) replaces this element (via regex ðŸ˜±) with pre-filled <event-entry>'s -->
            <p style="text-align: center">Â· Â· Â·</p>
          </event-entries>
          <button id="viewMoreEvents" onclick="eventsFilter.showMore();">
            <style>
              events-filter:not(:has(event-entry)) #viewMoreEvents {
                display: none;
              }

              events-filter[all-shown] #viewMoreEvents {
                display: none;
              }

              #viewMoreEvents {
                display: flex;
                flex-flow: row nowrap;
                background-color: var(--color-green) !important;
                align-items: center;
                justify-content: initial;
                color: var(--color-light);
                gap: 1rem;
                font-size: 0.66rem;
                font-weight: 600;
                width: 12rem;
                height: 3rem;
                margin-inline: auto;
              }
            </style>
            <svg-mask
              style="--src: url('/assets/icons/loica.svg'); --color: var(--color-light); width: 30px; height: 18px"
            >
            </svg-mask>
            Ver mÃ¡s eventos
          </button>
        </events-filter>
      </section>
      <section id="about">
        <style>
          #about {
            display: flex;
            flex-flow: column nowrap;
            align-items: center;
            text-align: center;
          }
        </style>
        <img src="/assets/images/mountain.svg" height="100" alt="" />
      </section>
    </main>
    <script type="module" src="/components/site-footer.js"></script>
    <site-footer></site-footer>

    <style>
      section#eventos {
        & events-filter {
          display: flex;
          flex-flow: column;
          gap: 3rem;
          text-wrap: balance;
          max-width: 60ch;
          margin-inline: auto;

          & form {
            display: var(--form-display, flex);
            flex-flow: column nowrap;
            align-items: stretch;
            text-align: center;
            gap: 0.66rem;
            width: 13rem;
            margin-inline: auto;

            & .form-filters-as-heading {
              margin: 0;
              display: inherit;
              flex-flow: inherit;
              align-items: inherit;
              gap: inherit;
              font-weight: 1.2rem;
              letter-spacing: initial;

              & :not(span) {
                font-weight: normal;
                font-size: initial;
              }
            }

            & button,
            & select,
            & input {
              padding: 0.5rem;
              text-align: inherit;
              height: 2.3rem;
              min-height: max-content;
              font: inherit;
            }
          }

          & > *:not(event-entries) {
            text-transform: uppercase;
          }
        }
        &:not(:has(events-filter)) {
          /* Only one event is shown */
          --form-display: none;
          --summary-display: none;
        }

        & event-entries {
          display: flex;
          flex-flow: column nowrap;
          max-width: 90ch;
          margin-inline: auto;
          gap: 2rem;
          width: 100%;

          & time {
            display: none; /* Shown per [date] via js custom css */
            font-family: var(--font-family-heading);
            text-align: center;
            position: sticky;
            top: 1rem;
            width: 17ch;
            margin-inline: auto;
            color: var(--color-light);
            font-size: 1rem;
            font-weight: 500;
            padding: 0.3rem;
            z-index: 1;

            &::before {
              content: "";
              inset: 0;
              width: 100%;
              position: absolute;
              z-index: -1;
              background-color: var(--color-red);
              border-radius: calc(var(--border-radius) / 2);
            }
          }
        }

        & event-entry:not([hidden]) {
          &[excluded] {
            display: none;
          }

          & .carousel {
            display: flex;
            position: relative;
            overflow-x: auto;
            width: 100%;
            height: auto;
            min-height: 15rem;
            max-height: 80vh;
            object-fit: contain;
            cursor: pointer;
            border-radius: 10px;
            scroll-snap-type: x mandatory;
            overscroll-behavior-x: contain;
            scroll-marker-group: after;
            scrollbar-width: none;
            counter-increment: carousel-counter;
            /* anchor-name: --carousel; SET VIA JS IN <publication-entry> , as it must be unique*/

            &::scroll-button(left) {
              content: "â—„" / "Imagen anterior";
              left: calc(anchor(left) - 2.2rem);
            }

            &::scroll-button(right) {
              content: "â–º" / "Imagen siguiente";
              right: calc(anchor(right) - 2.2rem);
            }

            &::scroll-button(*) {
              /* position-anchor: --carousel;  SET VIA JS IN <publication-entry> , as it must be unique*/
              position: absolute;
              align-self: anchor-center;
              background: none;
              border: none;
              padding: 1rem;
              cursor: pointer;
              height: 15rem;
              font-family: monospace;
              line-height: 1;
            }

            &:has(img:only-child)::scroll-button(*) {
              display: none;
            }

            &::scroll-button(*):focus-visible {
              outline-offset: 0.5rem;
            }

            /* The two repeated sections below fail when combined */
            & + [part="carousel-dots"] {
              display: flex;
              justify-content: center;
              margin-block-start: -0.5rem;
              width: min-content;
              margin-inline: auto;
              font-size: 0.5rem; /* Reduce size to match ::scroll-marker-group */
              z-index: 1;

              > * {
                padding: 0.5rem;
                background: none;
                appearance: none;
                display: grid;
                place-content: center;
              }
            }

            &::scroll-marker-group {
              display: flex;
              justify-content: center;
              margin-block-start: -0.5rem;
              margin-block-end: 1rem;
              width: min-content;
              margin-inline: auto;
            }

            &:has(img:only-child)::scroll-marker-group {
              /* Hide dots when only one img is available */
              display: none;
            }

            img {
              scroll-snap-align: center;
              scroll-snap-stop: always;
              object-fit: contain;
              width: 100%;
              flex-shrink: 0;

              &::scroll-marker {
                content: "â—";
                height: 1em;
                width: 1em;
                text-decoration: none;
                color: var(--color-green);
                padding: 0.3rem;
              }

              &::scroll-marker:target-current {
                color: var(--color-yellow);
              }
            }
          }

          & .event-image {
            width: 100%;
            height: auto;
            min-height: 15rem;
            max-height: 80vh;
            object-fit: contain;
            cursor: pointer;
            border-radius: 10px;
          }

          & .badges {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            text-transform: uppercase;

            font-weight: bold;
            letter-spacing: 0.1rem;

            & > * {
              display: inline-block;
              padding: 0.5rem 1rem;
              font-size: 0.66rem;
              font-weight: 400;
              line-height: 1;
              color: #fff;
              text-align: center;
              white-space: nowrap;
              border-radius: calc(var(--border-radius) / 2);

              &[data-type="Taller"] {
                background-color: var(--color-yellow);
              }

              &[data-type="Evento"] {
                background-color: var(--color-green);
              }
            }
          }

          & [part="where-and-when"] {
            width: max-content;
            margin-inline: auto;
            align-self: center;
            font-weight: normal;
          }

          & [part="title"],
          & [part="where-and-when"] {
            text-transform: uppercase;
            margin: 0;
          }

          & [part="title"],
          & [part="where-and-when"] {
            &::after {
              content: "";
              display: block;
              border-block-end: 1px solid var(--color);
              margin-block: 0.5rem;
            }
          }

          & [part="title"]::after {
            margin-block-end: 0.25rem;
          }

          & [part="buttons"] {
            display: flex;
            justify-content: space-evenly;
            align-items: center;
          }

          & details {
            & summary {
              display: var(--summary-display, revert);
              cursor: pointer;
              position: relative;

              &::-webkit-details-marker {
                display: none;
              }
            }
          }

          & [part="description"] {
            word-break: break-word;
            text-wrap: balance;
            text-align: start;
            margin-block: 0.5rem 0;
          }

          & [part="button"] {
            border-radius: 2px;
            text-decoration: none;
            cursor: pointer;
            transition-duration: 0.2s;
            padding: 0.5rem 0.5rem 0;
            border: none;
            background: none;
            outline: none;

            &:hover,
            &:focus {
              background-color: color-mix(in srgb, var(--color, currentColor) 10%, transparent);
            }
          }
        }
      }

      select-styled {
        position: relative;

        &::after {
          content: "";
          position: absolute;
          top: 50%;
          right: 0.5rem;
          width: 0;
          height: 0;
          border-left: 0.25rem solid transparent;
          border-right: 0.25rem solid transparent;
          border-top: 0.25rem solid gray;
          margin-top: -0.1rem;
        }

        & > select {
          /* Cross browser styling */
          appearance: none;
          border-radius: 0;
          text-align: center !important;
          width: 100%;
          color: currentColor;
        }
      }
    </style>

    <script type="module">
      import { getGoogleSheetEvents } from "/lib/get-events.js";
      import { escapeHtml, slugify, isDateToday, formatLocalDate } from "/lib/utils.js";

      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const eventsElement = document.querySelector("event-entries");

      /**
       *
       * @param {eventData} event
       * @returns {number}
       */
      function getSortOrder(event) {
        const date = new Date(event.startsAt);
        const items = [date.getFullYear() - 2000, date.getMonth(), date.getDate(), date.getHours(), date.getMinutes()];
        return Number(items.map((t) => t.toString().padStart(2, "0")).join(""));
      }

      /**
       * @param {EventResponse} event
       */
      function appendEvent(eventData, { open } = {}) {
        const eventElement = document.createElement("event-entry");

        for (const [key, value] of Object.entries(eventData)) {
          // if (!Object.hasOwnProperty.call(eventData, key)) continue;
          if (!value) continue;
          eventElement.dataset[key] = value;
        }
        // Add date attribute to handle <time> title hidden logic
        eventElement.setAttribute("date", formatLocalDate(new Date(eventElement.dataset.startsAt)));

        if (open) {
          eventElement.open = true;
        }
        eventsElement.appendChild(eventElement);
      }

      async function showAllFutureEvents() {
        const upcomingEvents = (await getGoogleSheetEvents()).sort((a, b) => {
          return getSortOrder(a) - getSortOrder(b);
        });
        renderEvents(upcomingEvents);
        eventsFilter.updateUI();
      }

      /**
       * @param {Date} date
       * @returns {string}
       */
      function formatDateTitle(date) {
        return date
          .toLocaleDateString("es-AR", {
            weekday: "long",
            day: "2-digit",
            month: "2-digit",
          })
          .toUpperCase();
      }

      function addTimeEntry(eventDate, { prepend } = {}) {
        const dateTitle = document.createElement("time");
        const dateString = formatLocalDate(eventDate);
        dateTitle.setAttribute("date", dateString);
        dateTitle.textContent = formatDateTitle(eventDate);

        if (prepend) {
          dateTitle.style = "display: revert;"; // improve by adding css in SSR
          eventsElement.prepend(dateTitle);
          return dateTitle;
        }
        return eventsElement.appendChild(dateTitle);
      }

      async function renderEvents(events) {
        // Fuzzy search
        const url = new URL(location);
        const query = url.searchParams.get("q") || "";
        let eventsToAppend = [];
        eventsElement.innerHTML = ""; /* Clear loading message */

        if (query) {
          const { fuzzySearch } = await import("/lib/fuzzy-search-events.js");

          const searchResults = fuzzySearch(events, query);
          if (!searchResults) {
            eventsElement.innerHTML = /*html*/ `<p>No encontramos resultados con: ${query}</p>`; /* Clear loading message */
            return;
          }
          return appendEvent(searchResults[0].item, { open: true });
        }

        // Add date titles between events
        const dates = [];
        let lastDate = today;
        let shouldAddTime = true;
        for (const event of events) {
          lastDate.setHours(23, 59, 59, 999);
          const eventDate = new Date(event.startsAt);

          if (lastDate < eventDate) {
            shouldAddTime = true;
          }
          if (shouldAddTime) {
            addTimeEntry(eventDate);
            dates.push(formatLocalDate(eventDate));
            lastDate = eventDate;
            shouldAddTime = false;
          }
          appendEvent(event);
        }

        const style = document.createElement("style");
        style.textContent = dates
          .map(
            (date) => /*css*/ `
              time[date="${date}"]:has(~ event-entry[date="${date}"]:not([excluded]):not([hidden])) {
                display: revert !important;
              }
            `
          )
          .join("\n");
        eventsElement.appendChild(style);
      }

      // RUN

      // START: Service Worker
      /**
       * @type {ServiceWorkerRegistration}
       */
      let swRegistration;

      if ("serviceWorker" in navigator) {
        try {
          swRegistration = await navigator.serviceWorker.register("/service-worker.js", { type: "module" });
          console.log("Service Worker registered:", swRegistration);
        } catch (error) {
          console.log("Service Worker registration failed:", error);
        }
      }

      // END: Service Worker

      // Get events

      if (!document.querySelector("event-entry")) {
        // Normal flow when requesting /index.html
        showAllFutureEvents();
      } else {
        // SSR prerendered <event-entry> elements into the dom (vÃ­a [slug|locality].js)

        // Add missing sticky <time> entry before first event, since that's how we show the event's date now.
        addTimeEntry(new Date(document.querySelector("event-entry").dataset.startsAt), { prepend: true });

        // Scroll into event's section
        const focusElement = () => document.querySelector("section#eventos").scrollIntoView({ behavior: "smooth" });
        if (document.readyState === "complete") {
          focusElement();
        } else {
          window.addEventListener("load", focusElement);
        }
      }

      // UX improvements when seeing a locality page (/lugar/locality-slug)
      if (location.pathname.includes("/lugar/")) {
        const linkToHighlight = document.querySelector(`[href="${location.pathname}"]`);
        if (linkToHighlight) linkToHighlight.style.fontWeight = "bolder";
        const localitySlug = location.pathname.replace(/\/lugar\/(.*)\//, "$1");
        // Highlight selected locality on dropdown menu
        for (const option of document.querySelectorAll("[name='locality'] option")) {
          if (slugify(option.value) == localitySlug) {
            option.selected = true;
            break;
          }
        }
        document.querySelector("[name='locality']").disabled = true;
      }

      //
    </script>

    <script type="module" defer>
      // Events list schema org script for rich results in google (hopefully)
      async function injectSchemaOrgScript() {
        try {
          const schemaString = await (await fetch("/events/schema.jsonld")).text();
          const script = document.createElement("script");
          script.type = "application/ld+json";
          script.textContent = schemaString;
          document.head.appendChild(script);
        } catch (err) {
          console.warn(err);
        }
      }

      const url = new URL(location);
      if (url.pathname == "/") await injectSchemaOrgScript();
    </script>

    <!-- Google Tag Manager -->
    <script defer>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-MZ99GDSV");
    </script>

    <script>
      if (!location.origin.includes("localhost")) {
        window.va =
          window.va ||
          function () {
            (window.vaq = window.vaq || []).push(arguments);
          };

        // Vercel Speed Insights
        window.si =
          window.si ||
          function () {
            (window.siq = window.siq || []).push(arguments);
          };
      }
    </script>
    <script async src="/_vercel/insights/script.js"></script>
    <script async src="/_vercel/speed-insights/script.js"></script>

    <noscript>
      <link rel="stylesheet" href="/legacy.css" />
    </noscript>
    <script>
      // Legacy browsers css support
      // Generated by scripts/build-legacy-css.js on `make legacy-css` or 'npm run build:legacy-css'
      if (!CSS.supports("selector(&)") || !CSS.supports("selector(has)")) {
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = "/legacy.css";
        document.body.appendChild(link);
      }
    </script>
  </body>
</html>
