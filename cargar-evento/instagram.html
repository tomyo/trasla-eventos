<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>S</title>
  </head>
  <body>
    <h1>Cargar evento de Instagram</h1>
    <form
      action="https://hook.us2.make.com/810vwbmrsrbh6yi6rqzvp6ak5au7dtfc"
      method="post"
      enctype="multipart/form-data"
    >
      <label for="url">Link al post (videos o historias no soportadas)</label>
      <input type="url" id="url" name="url" required placeholder="https://www.instagram.com/p/DIOnBf5RzAA/" />

      <button type="submit">Cargar evento</button>
    </form>
    <style>
      form {
        display: grid;
        gap: 1rem;
      }
    </style>
    <script type="module">
      const SHARE_TARGET_ACTION = "/share-target"; // Also used as the cache key for the shared data
      const form = document.querySelector("form");

      // form.addEventListener("submit", async (event) => {
      //   event.preventDefault();
      //   const formData = new FormData(event.target);
      //   const cache = await caches.open(SHARE_TARGET_ACTION);
      //   let action = form.action;

      //   const response = await fetch(action, {
      //     method: form.method,
      //     body: formData,
      //   });

      //   if (!response || !response.ok) {
      //     alert(response.statusText);
      //     return;
      //   }
      //   const result = await response.text();
      //   console.log("response:", result);
      // });

      async function hydrateWithCachedData() {
        const cache = await caches.open(SHARE_TARGET_ACTION);

        // Hydrate texts
        for (const input of document.querySelectorAll("input:not([type=file], textarea")) {
          const key = input.name;
          const response = await cache.match(key);

          if (!response || !response.ok) {
            console.info(`Cache miss for key ${key}`);
            continue;
          }
          const contentType = response.headers.get("content-type");
          if (!contentType?.includes("text")) {
            console.warn(`Content type mismatch for key ${key}: expected text but got ${contentType}`);
            continue;
          }
          console.info(`Hydrating ${key} from cache`);
          input.value = await response.text();
        }
      }

      hydrateWithCachedData();
    </script>
  </body>
</html>
